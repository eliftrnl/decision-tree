<div class="container">
  <div class="header">
    <div class="header-left">
      <button class="btn btn-secondary" (click)="goBack()">â† Tablolara DÃ¶n</button>
      <h1>Kolon YÃ¶netimi</h1>
      <span class="subtitle">{{ tableName }}</span>
    </div>
    <button class="btn btn-success" (click)="openCreateModal()">
      + Yeni Kolon
    </button>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="alert alert-error">
    {{ error() }}
    <button class="btn btn-sm" (click)="error.set(null)">âœ•</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>YÃ¼kleniyor...</p>
  </div>

  <!-- Columns Table -->
  <div *ngIf="!loading()" class="columns-section">
    <div *ngIf="columns().length === 0" class="empty-state">
      <p>HenÃ¼z kolon eklenmemiÅŸ</p>
      <button class="btn btn-primary" (click)="openCreateModal()">Ä°lk Kolonu Ekle</button>
    </div>

    <div *ngIf="columns().length > 0" class="table-wrapper">
      <table class="columns-table">
        <thead>
          <tr>
            <th>SÄ±ra</th>
            <th>Kolon AdÄ±</th>
            <th>Veri Tipi</th>
            <th>Zorunlu</th>
            <th>Benzersiz Anahtar</th>
            <th>Format</th>
            <th>Max Uzunluk</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let column of columns()">
            <td>{{ column.orderIndex + 1 }}</td>
            <td class="font-weight-bold">{{ column.columnName }}</td>
            <td>{{ getDataTypeLabel(column.dataType) }}</td>
            <td>
              <span *ngIf="column.isRequired" class="badge badge-success">Evet</span>
              <span *ngIf="!column.isRequired" class="badge badge-gray">HayÄ±r</span>
            </td>
            <td>
              <span *ngIf="column.isUniqueIdentifier" class="badge badge-warning">ğŸ”‘ Evet</span>
              <span *ngIf="!column.isUniqueIdentifier" class="badge badge-gray">HayÄ±r</span>
            </td>
            <td>{{ column.format || '-' }}</td>
            <td>{{ column.maxLength || '-' }}</td>
            <td>
              <span [class]="getStatusClass(column.statusCode)">
                {{ getStatusLabel(column.statusCode) }}
              </span>
            </td>
            <td class="action-buttons">
              <button class="btn btn-sm btn-info" (click)="openUpdateModal(column)">âœ DÃ¼zenle</button>
              <button class="btn btn-sm btn-danger" (click)="deleteColumn(column)">âœ• Sil</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Navigation Button -->
    <div class="footer-actions">
      <button class="btn btn-primary" (click)="navigateToDataEntry()">
        â†’ Veri GiriÅŸ EkranÄ±na Git
      </button>
    </div>
  </div>

  <!-- Modal: Create/Edit Column -->
  <div *ngIf="showModal()" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ modalMode() === 'create' ? 'Yeni Kolon Ekle' : 'Kolonu DÃ¼zenle' }}</h2>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>Kolon AdÄ± *</label>
          <input
            type="text"
            [(ngModel)]="form.columnName"
            placeholder="Ã–rn: MusteriNo"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Excel BaÅŸlÄ±ÄŸÄ± (Opsiyonel)</label>
          <input
            type="text"
            [(ngModel)]="form.excelHeaderName"
            placeholder="Kolon adÄ±yla aynÄ± kullanÄ±lacak"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>AÃ§Ä±klama (Opsiyonel)</label>
          <textarea
            [(ngModel)]="form.description"
            placeholder="Kolon hakkÄ±nda aÃ§Ä±klama"
            class="form-control"
            rows="2"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Veri Tipi *</label>
            <select [(ngModel)]="form.dataType" class="form-control">
              <option *ngFor="let opt of dataTypeOptions" [value]="opt.value">
                {{ opt.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Zorunlu</label>
            <input
              type="checkbox"
              [(ngModel)]="form.isRequired"
              class="form-checkbox"
            />
          </div>

          <div class="form-group">
            <label>Excel Ä°Ã§e Aktar iÃ§in Benzersiz Anahtar</label>
            <input
              type="checkbox"
              [(ngModel)]="form.isUniqueIdentifier"
              class="form-checkbox"
              title="Bu kolonu satÄ±rlarÄ± eÅŸleÅŸtirmek iÃ§in kullan (TCKN, ID vb.)"
            />
            <small style="display: block; margin-top: 4px; color: #666;">
              Excel'den veri alÄ±rken satÄ±rlarÄ± bu alan ile eÅŸleÅŸtir
            </small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Format (Opsiyonel)</label>
            <input
              type="text"
              [(ngModel)]="form.format"
              placeholder="Ã–rn: dd.MM.yyyy"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Max Uzunluk (Opsiyonel)</label>
            <input
              type="number"
              [(ngModel)]="form.maxLength"
              placeholder="Ã–rn: 100"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-group">
          <label>Durum</label>
          <select [(ngModel)]="form.statusCode" class="form-control">
            <option *ngFor="let opt of statusOptions" [value]="opt.value">
              {{ opt.label }}
            </option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-primary" (click)="saveColumn()">Kaydet</button>
      </div>
    </div>
  </div>
</div>
