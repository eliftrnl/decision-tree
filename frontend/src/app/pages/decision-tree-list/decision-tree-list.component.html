<div class="container">
  <div class="header">
    <h1>Karar AÄŸaÃ§larÄ±</h1>
    <button class="btn btn-success" (click)="openCreateModal()">
      + Yeni Karar AÄŸacÄ±
    </button>
  </div>

  <!-- Filtre BÃ¶lÃ¼mÃ¼ -->
  <div class="filter-section">
    <h2>Filtre</h2>
    <div class="filter-grid">
      <div class="form-group">
        <label for="code">Kod (Tam EÅŸleÅŸme)</label>
        <input 
          id="code" 
          type="text" 
          [(ngModel)]="filter.code" 
          placeholder="Ã¶rn: dt-1"
          (keyup.enter)="search()"
        />
      </div>

      <div class="form-group">
        <label for="name">Ad (Ä°Ã§erir)</label>
        <input 
          id="name" 
          type="text" 
          [(ngModel)]="filter.name" 
          placeholder="Ã¶rn: Customer"
          (keyup.enter)="search()"
        />
      </div>

      <div class="form-group">
        <label for="status">Durum</label>
        <select id="status" [(ngModel)]="filter.statusCode">
          <option [ngValue]="undefined">TÃ¼mÃ¼</option>
          <option [ngValue]="1">Aktif</option>
          <option [ngValue]="2">Pasif</option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn btn-primary" (click)="search()" [disabled]="loading()">
        {{ loading() ? 'YÃ¼kleniyor...' : 'Sorgula' }}
      </button>
      <button class="btn btn-secondary" (click)="clearFilters()">
        Temizle
      </button>
    </div>
  </div>

  <!-- SonuÃ§ BÃ¶lÃ¼mÃ¼ -->
  <div class="results-section">
    <!-- Loading State -->
    <div *ngIf="loading()" class="state-message">
      <div class="spinner"></div>
      <p>Veriler yÃ¼kleniyor...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error() && !loading()" class="state-message error">
      <p>{{ error() }}</p>
    </div>

    <!-- Empty State (Ä°lk AÃ§Ä±lÄ±ÅŸ) -->
    <div *ngIf="!hasSearched() && !loading() && !error()" class="state-message empty">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
      <p>Filtre seÃ§erek "Sorgula" butonuna basÄ±n</p>
    </div>

    <!-- No Results State -->
    <div *ngIf="hasSearched() && trees().length === 0 && !loading() && !error()" class="state-message empty">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16">
        <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L8 11.5 1.314 8.464A.5.5 0 0 1 1 8V.5a.5.5 0 0 1 .707-.455l6.5 3.25a.5.5 0 0 0 .586 0l6.5-3.25a.5.5 0 0 0 .485-.06z"/>
        <path d="M7.5 6.5 1 3.5v4.586l6.5 3.25V6.5z"/>
        <path d="M14.5 3.5 8 6.5v4.836l6.5-3.25V3.5z"/>
      </svg>
      <p>SonuÃ§ bulunamadÄ±</p>
    </div>

    <!-- Tablo -->
    <table *ngIf="trees().length > 0 && !loading()" class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Kod</th>
          <th>Ad</th>
          <th>Durum</th>
          <th>Son Ä°ÅŸlem Tarihi</th>
          <th>Ä°ÅŸlemler</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tree of trees()" (click)="selectTree(tree)" class="clickable-row">
          <td>{{ tree.id }}</td>
          <td><strong>{{ tree.code }}</strong></td>
          <td>{{ tree.name }}</td>
          <td>
            <span [class]="getStatusClass(tree.statusCode)">
              {{ getStatusText(tree.statusCode) }}
            </span>
          </td>
          <td>{{ tree.updatedAtUtc ? (tree.updatedAtUtc | date:'dd.MM.yyyy HH:mm') : '-' }}</td>
          <td class="action-buttons">
            <button class="btn btn-sm btn-primary" (click)="navigateToTables(tree.id); $event.stopPropagation()" title="TablolarÄ± yÃ¶net">
              ðŸ“‹ Tablolar
            </button>
            <button class="btn btn-sm btn-info" (click)="openUpdateModal(tree); $event.stopPropagation()">
              DÃ¼zenle
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteTree(tree, $event)">
              Sil
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal()" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ modalMode() === 'create' ? 'Yeni Karar AÄŸacÄ±' : 'Karar AÄŸacÄ± DÃ¼zenle' }}</h2>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label for="modal-code">Kod *</label>
        <input 
          id="modal-code" 
          type="text" 
          [(ngModel)]="form.code" 
          placeholder="Ã¶rn: DT-001"
          required
        />
      </div>

      <div class="form-group">
        <label for="modal-name">Ad *</label>
        <input 
          id="modal-name" 
          type="text" 
          [(ngModel)]="form.name" 
          placeholder="Ã¶rn: MÃ¼ÅŸteri Karar AÄŸacÄ±"
          required
        />
      </div>

      <div class="form-group">
        <label for="modal-status">Durum *</label>
        <select id="modal-status" [(ngModel)]="form.statusCode">
          <option [ngValue]="1">Aktif</option>
          <option [ngValue]="2">Pasif</option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">Ä°ptal</button>
      <button class="btn btn-primary" (click)="saveTree()" [disabled]="!form.code || !form.name">
        {{ modalMode() === 'create' ? 'OluÅŸtur' : 'GÃ¼ncelle' }}
      </button>
    </div>
  </div>
</div>
